<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Happy Birthday, Samra! üéâüéÇ</title>
  <style>
    /* Global Styles */
    body {
      font-family: 'Bookman Old Style', serif;
      margin: 0;
      padding: 0;
      background-size: cover;
      background-position: center;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
    }
    .container {
      display: none; /* All pages hidden by default */
      max-width: 90%;
      background: rgba(0, 0, 0, 0.6);
      padding: 30px;
      border-radius: 10px;
    }
    /* Page Specific Styles */
    #countdown-section h2 {
      font-size: 3rem;
      margin: 10px 0;
    }
    #countdown {
      font-size: 4rem;
      font-weight: bold;
      margin-top: 20px;
    }
    h1 {
      font-family: 'Times New Roman', serif;
      font-size: 4rem;
      color: #ffcc00;
      margin-bottom: 20px;
    }
    p {
      font-size: 1.5rem;
      line-height: 1.6;
    }
    .next-button {
      font-size: 1.5rem;
      padding: 10px 20px;
      background: #ffcc00;
      color: black;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 20px;
    }
    .cake-img, .wish-img {
      width: 300px;
      border-radius: 10px;
      margin-top: 20px;
    }
    /* Final Wish Typography */
    .wish-title {
      font-family: 'Times New Roman', serif;
      font-size: 4rem;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .wish-text {
      font-family: 'Bookman Old Style', serif;
      font-size: 1.5rem;
      line-height: 1.6;
    }
  </style>
</head>
<body id="page-background">
  <!-- Page 1: Countdown Page (Background = Image 1) -->
  <div id="countdown-section" class="container">
    <h2>‚è≥ Time Till Cutie's Birthday</h2>
    <h2 id="countdown">Loading...</h2>
  </div>

  <!-- Page 2: Birthday Greeting (Background = Image 2) -->
  <div id="happy-birthday-page" class="container">
    <h1>üéâ Happy Birthday Samra üéÇ</h1>
    <button class="next-button" onclick="goToBlowCandles()">Next Page</button>
  </div>

  <!-- Page 3: Blow the Candles (Background = Image 3) -->
  <div id="blow-candles-page" class="container">
    <h1>üéÇ Blow the Candles! üé§</h1>
    <p id="blow-text">Blow into your microphone!</p>
    <!-- Image 4: Cake with lit candles (PNG) -->
    <img src="cake-lit.png" alt="Cake with Lit Candles" class="cake-img" id="cake-image">
    <!-- The "Next Page" button will appear after the blow detection -->
  </div>

  <!-- Page 4: Final Wish (Background = Image 6) -->
  <div id="birthday-message" class="container">
    <div class="wish-title">Happy Birthday Samra</div>
    <div class="wish-text">
      My dearest Samra,<br><br>
      The moment we met six months ago, you've been one of the best parts of my life. Your presence alone makes everything easier, and a lot more beautiful. The way you carry yourself, your kindness, your energy‚Äîit's something rare, and I feel lucky to have you in my life.<br><br>
      Those pretty eyes of yours, they hold a kind of magic that makes the world pause for a second. You make every moment unforgettable.<br><br>
      On your special day, know that you deserve all the happiness, love, and success in the world. I hope this year brings you immense joy and ease.<br><br>
      Keep shining, queen. May Allah bless you with a long, healthy, and happy life. Enjoy your day to the fullest!
    </div>
    <br>
    <!-- Image 7: Cute cat with hat -->
    <img src="wish-cat.png" alt="Cute Cat with Hat" class="wish-img">
  </div>

  <script>
    // Utility: Get query parameter 'user'
    function getUser() {
      const params = new URLSearchParams(window.location.search);
      return params.get('user');
    }

    // Background images (update these filenames as needed)
    const backgrounds = {
      countdown: 'image1.jpg',      // Page 1 background (Image 1)
      happyBirthday: 'image2.jpg',  // Page 2 background (Image 2)
      cake: 'image3.jpg',           // Page 3 background (Image 3)
      wish: 'image6.jpg'            // Page 4 background (Image 6)
    };

    // Set page background image
    function setBackground(imageFile) {
      document.getElementById('page-background').style.background = `url('${imageFile}') no-repeat center center fixed`;
      document.getElementById('page-background').style.backgroundSize = 'cover';
    }

    // Developer mode: If query parameter is ?user=daniyal, bypass countdown.
    function checkAccess() {
      const user = getUser();
      const birthday = new Date("Feb 5, 2024 00:00:00");
      const now = new Date();

      if (user === "daniyal") {
        // Bypass countdown; show Page 2 immediately.
        document.getElementById("countdown-section").style.display = "none";
        document.getElementById("happy-birthday-page").style.display = "block";
        setBackground(backgrounds.happyBirthday);
      } else {
        // Normal user: if before birthday, show only countdown.
        if (now < birthday) {
          document.getElementById("countdown-section").style.display = "block";
          setBackground(backgrounds.countdown);
        } else {
          // After birthday, show Page 2
          document.getElementById("countdown-section").style.display = "none";
          document.getElementById("happy-birthday-page").style.display = "block";
          setBackground(backgrounds.happyBirthday);
        }
      }
    }

    // Countdown timer functionality (only used for normal users)
    function updateCountdown() {
      const birthday = new Date("Feb 5, 2024 00:00:00").getTime();
      const now = new Date().getTime();
      const timeLeft = birthday - now;

      if (timeLeft > 0) {
        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        document.getElementById("countdown").innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
      } else {
        // Time is up: Transition to Page 2.
        document.getElementById("countdown-section").style.display = "none";
        document.getElementById("happy-birthday-page").style.display = "block";
        setBackground(backgrounds.happyBirthday);
      }
    }

    // Page Transitions:
    // From Page 2 (Birthday Greeting) to Page 3 (Blow Candles)
    function goToBlowCandles() {
      document.getElementById("happy-birthday-page").style.display = "none";
      document.getElementById("blow-candles-page").style.display = "block";
      setBackground(backgrounds.cake);
      
      // Start microphone detection to blow out the candles.
      navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        let audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let microphone = audioContext.createMediaStreamSource(stream);
        let analyser = audioContext.createAnalyser();
        microphone.connect(analyser);
        analyser.fftSize = 256;
        let dataArray = new Uint8Array(analyser.frequencyBinCount);
        let blowCount = 0;
        
        function detectBlow() {
          analyser.getByteFrequencyData(dataArray);
          let volume = dataArray.reduce((a, b) => a + b, 0) / dataArray.length;
          
          if (volume > 50) {  // Adjust this threshold as needed
            blowCount++;
            if (blowCount >= 2) {
              // Switch cake image from lit (Image 4) to blown-out (Image 5)
              document.getElementById("cake-image").src = "cake-blown.png";
              document.getElementById("blow-text").innerText = "Candles blown out!";
              // Show "Next Page" button after a short delay.
              setTimeout(() => {
                let nextBtn = document.createElement("button");
                nextBtn.innerText = "Next Page";
                nextBtn.className = "next-button";
                nextBtn.onclick = goToWishPage;
                document.getElementById("blow-candles-page").appendChild(nextBtn);
              }, 2000);
              return; // Stop further detection
            }
          }
          requestAnimationFrame(detectBlow);
        }
        detectBlow();
      });
    }

    // Transition from Page 3 (Blow Candles) to Page 4 (Final Wish)
    function goToWishPage() {
      document.getElementById("blow-candles-page").style.display = "none";
      document.getElementById("birthday-message").style.display = "block";
      setBackground(backgrounds.wish);
    }

    // Initialize access and countdown:
    checkAccess();
    if (getUser() !== "daniyal") {
      // Only start countdown for normal users.
      updateCountdown();
      setInterval(updateCountdown, 1000);
    }
  </script>
</body>
</html>
